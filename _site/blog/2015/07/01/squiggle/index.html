<!DOCTYPE html>
<html lang="en">
<head>


<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Brian Mock">
<meta name="description" content="Squiggle is a compile-to-JS programming language">
<meta name="theme-color" content="#e8fdf5">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@wavebeem">
<meta name="twitter:creator" content="@wavebeem">
<meta name="og:title" content="Squiggle: A JS Language">
<meta name="og:description" content="Squiggle is a compile-to-JS programming language">
<meta name="og:image" content="https://mockbrian.com/brian.png">

<title>Squiggle: A JS Language</title>

<link rel="stylesheet" media="screen" href="/tachyons.min.css?t=1563254458666645000">
<link rel="stylesheet" media="screen" href="/style.css?t=1563254458666645000">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  (function(host) {
    var ids = {
      "dev.mockbrian.com": "UA-52704502-2",
      "mockbrian.com": "UA-52704502-1",
    };
    if (host in ids) {
      ga("create", ids[host], "auto");
      ga("send", "pageview");
    }
  }(window.location.host));
</script>

</head>
<body class="flex flex-column min-vh-100 bg-washed-green lh-copy helvetica">

<div class="flex-auto">





<!-- Small nav -->
<div class="dn-ns">
  <nav class="f3 flex flex-column mb4 bb dark-pink bw1 b--black-10">
    <a class="pa3 hover-bg-white-40 hover-bottomline link color-inherit pv2 ph3 flex-auto hover-outline b" href="/">Brian Mock</a>
    <a class="pa3 hover-bg-white-40 hover-bottomline link color-inherit pv2 ph3 flex-auto hover-outline" href="/">Home</a>
    <a class="pa3 hover-bg-white-40 hover-bottomline link color-inherit pv2 ph3 flex-auto hover-outline" href="/blog">Blog</a>
    <a class="pa3 hover-bg-white-40 hover-bottomline link color-inherit pv2 ph3 flex-auto hover-outline" href="/resume">Resume</a>
  </nav>
</div>

<!-- Big nav -->
<div class="dn db-ns">
  <nav class="f3 flex mb4 items-center bb dark-pink bw1 b--black-10">
    <a class="pa3 hover-bg-white-40 hover-bottomline link color-inherit b" href="/">Brian Mock</a>
    <a class="pa3 hover-bg-white-40 hover-bottomline link color-inherit" href="/">Home</a>
    <a class="pa3 hover-bg-white-40 hover-bottomline link color-inherit" href="/blog">Blog</a>
    <a class="pa3 hover-bg-white-40 hover-bottomline link color-inherit" href="/resume">Resume</a>
  </nav>
</div>


<main class="ph4-ns ph3 center flex-auto lh-copy Content">
  <h1 class="ma0 f1-ns f2 lh-title">
    <a href="#">Squiggle: A JS Language</a>
  </h1>
  <p class="ma0 helvetica">July 1, 2015</p>

  <h2>Note</h2>

<p>This was originally <a href="https://medium.com/@wavebeem/squiggle-a-compile-to-js-language-771e1a4abe5d">posted on Medium.com</a> on July 1, 2015, but I&#39;m reposting it on my personal blog on May 8, 2019.</p>

<h2>Why</h2>

<p>Yeah, I know: yet another programming language.</p>

<p>Still with me? You might be wondering why I decided to make a programming language. Here’s a few reasons:</p>

<ul>
<li>I can.</li>
<li>I’ve never written a compiled language before (Only an interpreted one: LatteScript).</li>
<li>I wanted an expression-oriented language.</li>
<li> I wanted immutable data (That is also transparently usable from JS).</li>
<li>I wanted constant variable bindings (Makes code easier to reason about).</li>
<li>I wanted function arity (argument count) checking (Fix common source of mistakes with callbacks and such).</li>
<li>I wanted a powerful runtime type system (TypeScript only enforces checks at compile time, forcing library authors to perform additional manual runtime checking to avoid processing incorrect data).</li>
<li>There’s a chance I might make something useful.</li>
</ul>

<p>Here’s the “Hello, World!” program:</p>
<div class="highlight"><pre><code class="language-" data-lang="">console.log("Hello, World!")
</code></pre></div>
<p>“But that’s just JavaScript without a semicolon,” you think.
“Is he just making another CoffeeScript?”
No.</p>

<h2>Factorial Example</h2>

<p>Let’s look at a more involved example:</p>
<div class="highlight"><pre><code class="language-" data-lang="">let (
    factorial = ~(n)
        if &lt;(n, 2)
        then 1
        else *(n, factorial(-(n, 1))),
    main = ~() factorial(4)
) in {"main": main}
</code></pre></div>
<p>We have a program where the main function computes factorial(4). Please excuse the prefix notation on the math operators, that’s likely to change in the future.</p>

<p>If I were to hand write the JavaScript for this module, it would look something like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="p">?</span>
        <span class="mi">1</span> <span class="p">:</span>
        <span class="nx">n</span> <span class="o">*</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">factorial</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span><span class="na">main</span><span class="p">:</span> <span class="nx">main</span><span class="p">};</span>
</code></pre></div>
<p>This probably looks cleaner than the Squiggle version, even if I had to say return everywhere. But the output of Squiggle is a bit more involved than this.</p>

<p>Here is the JavaScript output from Squiggle, with the Squiggle internal and standard library functions removed for clarity:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">factorial</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">LANG$$js_Error</span><span class="p">(</span><span class="s1">'...'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">$lt</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">?</span>
            <span class="mi">1</span> <span class="p">:</span>
            <span class="nx">$star</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">factorial</span><span class="p">(</span><span class="nx">$minus</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)));</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">main</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">LANG$$js_Error</span><span class="p">(</span><span class="s1">'...'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">factorial</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">LANG$$object</span><span class="p">([</span>
        <span class="p">[</span><span class="s1">'main'</span><span class="p">,</span> <span class="nx">main</span><span class="p">]</span>
    <span class="p">]);</span>
<span class="p">}());</span>
</code></pre></div>
<p>Notice how <code>&lt;</code> becomes <code>$lt</code>, and <code>*</code> becomes <code>$star</code>? These are internal Squiggle functions that wrap JavaScript’s built-in operators and will eventually provide type checking. No more <code>(3*&#39;hi&#39;)</code> giving you <code>NaN</code>. This will throw an error. The operator <code>++</code> will call <code>.concat()</code> if its arguments are both strings or both arrays.</p>

<p>Functions you create automatically have arity checking inserted. No more forgetting the argument to factorial and getting NaN. No more passing extra ignored arguments accidentally. There’s even plans to add runtime value assertions (pre- and post-conditions), as follows (subject to change):</p>
<div class="highlight"><pre><code class="language-" data-lang="">let (
    nonempty = ~(xs) &gt;(xs.length, 0),
    first = ~(xs: nonempty) xs[0]
) in {"first": first}
</code></pre></div>
<p>Also, <code>LANG$$object</code> creates an object using <code>Object.freeze</code>, so no one can ever mess up your values. And because it’s a function, not an object literal, keys can be computed values, not just string literals.</p>

<p>This code would assert that <code>nonempty(xs)</code> is true every time first is run, ensuring that the preconditions have been satisfied, or throwing an exception. The precondition could be any function returning a boolean value, allowing you to easily reuse constraints across many functions to ensure clean APIs in programs you write.</p>

<p>Unlike TypeScript, this would not detect any errors at compile time, but also unlike TypeScript, this would detect errors at runtime, even by plain JavaScript consumers.</p>

<h2>What’s Next?</h2>

<p>I already have a decent amount of language implemented, so my next post will probably be a dive into the concepts available in Squiggle.</p>

<p>You can find the source on <a href="https://github.com/squiggle-lang/squiggle-lang">GitHub</a>.</p>


  <div class="helvetica f3 mv4">
    <a
      class="ba bw1 br2 dark-pink db pv2 ph3 hover-bg-white-40 no-underline"
      href="/blog"
    >
      &lsaquo; Read other posts
    </a>
  </div>
</main>

<script type="module">
  // I would prefer to generate links for my h2 and h3 elements at build time,
  // but I can't figure out a good way to make Jekyll do that, sadly
  function slug(text) {
    return text
      .trim()
      .toLowerCase()
      .replace(/\'/gi, "")
      .replace(/[^a-z0-9]/gi, "-")
      .replace(/-{2,}/g, "-")
      .replace(/^-+|-+$/gm, "")
      .substring(0, 64);
  }

  for (const h of document.querySelectorAll("h2, h3")) {
    h.id = h.id || slug(h.textContent);
    h.innerHTML = "<a href='#" + h.id + "'>" + h.innerHTML + "</a>";
  }
</script>


</div>

<footer class="black-70 tc helvetica ph3 pv3 bt bw1 b--black-10 f4">
  &copy; 2019 Brian Mock
</footer>


</body>
</html>
